{% extends "app_base.html" %}

{% block main %}
  <!-- InstantSearch container -->
  <div class="search-container min-h-screen pb-16">
    <!-- Search box widget -->
    <div id="searchbox" class="mb-4"></div>
    
    <!-- Stats widget to show result counts -->
    <div id="stats" class="text-sm text-gray-600 mb-4"></div>

    <!-- Main results area -->
    <div class="search-results flex gap-4">
      <!-- Refinements/filters panel -->
      <div class="refinements w-64">
        <div id="clear-refinements" class="mb-4"></div>
        <div id="refinement-list"></div>
      </div>

      <!-- Results listing -->
      <div class="results flex-1">
        <div id="hits"></div>
      </div>
    </div>

    <!-- Sticky pagination at bottom -->
    <div id="pagination" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.24.0/dist/algoliasearch-lite.umd.js" integrity="sha256-b2n6oSgG4C1stMT/yc/ChGszs9EY/Mhs6oltEjQbFCQ=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.75.5/dist/instantsearch.production.min.js" integrity="sha256-Ge9l2WgQoXm9fEH5EX/9oXKOjZVrpOwrMK7vAF2oWKg=" crossorigin="anonymous"></script>

  <!-- Initialize InstantSearch -->
  <script>
    const search = instantsearch({
      indexName: '{{ ALGOLIA_INDEX_NAME }}',
      searchClient: algoliasearch(
        '{{ ALGOLIA_APP_ID }}',
        '{{ ALGOLIA_SEARCH_API_KEY }}'
      ),
    });

    // Add widgets
    search.addWidgets([
      instantsearch.widgets.searchBox({
        container: '#searchbox',
        placeholder: 'Search...',
        cssClasses: {
          root: 'relative',
          form: 'relative',
          input: 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500',
          submit: 'hidden',
          reset: 'hidden'
        }
      }),
      
      instantsearch.widgets.stats({
        container: '#stats',
      }),

      instantsearch.widgets.hits({
        container: '#hits',
        templates: {
          empty: 'No results found.',
          item: (hit) => `
            <div class="hit bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4 hover:shadow-md transition-shadow">
              <h3 class="text-lg font-semibold text-gray-900 mb-2">
                ${instantsearch.highlight({ hit, attribute: 'name' }) || hit.name}
              </h3>
              ${hit.description ? `<p class="text-gray-600 mb-2">${hit.description}</p>` : ''}
              ${hit.country ? `<p class="text-sm text-gray-500">Country: ${hit.country}</p>` : ''}
              ${hit.articles_count ? `
                <div class="mt-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  Articles: ${hit.articles_count}
                </div>
              ` : ''}
            </div>
          `
        }
      }),

      instantsearch.widgets.pagination({
        container: '#pagination',
        cssClasses: {
          root: 'flex justify-center items-center gap-2',
          item: 'px-3 py-2 rounded-md hover:bg-gray-100',
          selectedItem: 'bg-blue-500 text-white hover:bg-blue-600',
          disabledItem: 'opacity-50 cursor-not-allowed',
          firstPage: 'font-medium',
          lastPage: 'font-medium',
          previousPage: 'font-medium',
          nextPage: 'font-medium'
        }
      }),

      instantsearch.widgets.refinementList({
        container: '#refinement-list',
        attribute: 'categories',
        cssClasses: {
          list: 'space-y-2',
          label: 'flex items-center',
          checkbox: 'mr-2 rounded border-gray-300 text-blue-500 focus:ring-blue-500',
          count: 'ml-2 text-sm text-gray-500'
        }
      }),

      instantsearch.widgets.clearRefinements({
        container: '#clear-refinements',
        cssClasses: {
          button: 'px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 w-full text-center'
        }
      }),
    ]);

    // Start the search
    search.start();
  </script>
{% endblock %}
